{% extends 'base.html' %}
{% load static %}
{% block head %}
    <link rel="stylesheet" href="{% static 'CSS/home.css' %}">
{% endblock head %}
{% block content %}
<!-- Welcome Box -->
<div class="container">
    <div id="welcome-box" class="container" style="z-index: 1">
        <!-- Your home page content here -->
        <h1 id="welcome" class="display-5">Elnahass Sons Group</h1>
        <p style="margin-bottom: 5px; font-size: 17px; color: white">Empowering Progress with Expertise - Elnahass Sons Group</p>
        <p style="font-size: 17px; color: white">Where Vision Meets Precision, Building Dreams and Redefining Success.</p>
    </div>
</div>

<!-- Slider -->
<div class="tcb-bs-fullscreen">
    <div id="carousel-example-generic" class="carousel slide carousel-bg">
        <!-- Indicators -->
        <ol class="carousel-indicators" id="nav-slider">

        </ol>
        <!-- Wrapper for slides -->
        <div id="slider-pics" class="carousel-inner" role="listbox">

        </div>
        <!-- Controls -->
        <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev" id="prev">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next" id="next">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
</div>
<!-- Navbar -->

<!-- Projects Section -->
<section id="projects" class="bg-white py-3">
    <div class="container">
        <div class="container" id="projects-div-title" ><h1 id="projects-title" class="text-center">Our Work</h1></div>
        <!-- Projects Row -->
        {% for item in  items %}
            <div class="project row" id="p{{ item.project_id }}" >
                {% for img in item.images.all %}
                    {% if img.thumbnail %}
                        <div class="col-md-6" id="p{{ item.project_id }}-img">
                            <img draggable="false" src="{{ img.url }}" alt="" class="project-img w-100" />
                        </div>
                    {% endif %}
                {% endfor %}
                <!-- /.col-md-6 -->
                <div class="col-md-6" id="p{{ item.project_id }}-txt">
                    <div class="row row-edited align-items-center">
                        <div class="project-txt col">
                            <h1 class="display-3">{{ item.name }}</h1>
                            <p class="lead">{{ item.shortDesc }}
                                <br /><br />
                            <div id="p-details"><button class="detailsbtn" id="showbtn{{ item.project_id }}">
                                Show Details
                            </button></div>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- /.col-md-6 -->
            </div>
        {% endfor %}
        <!-- End Row -->
    </div>
</section>
<!-- More Details Section -->
<section id="join_sec" class="bg-white py-3">
    <div class="container">
        <div class="row row-edited">
            <div id="join-section"  class="col-sm">
                <h2 id="joinUs-title" class="display-4">Get Your Work Done!</h2>
                <div class="row row-edited" id="joinUs-body">
                    <p class="lead" style="text-align: center; width: 100%">Embark on a Journey of Excellence:
                        Let Elnahass Sons Group Build Your Dream Project</p>
                </div>
                <div class="row row-edited d-flex justify-content-center joinus-btn-div">
                    <button id="joinBTN2" class="joinus-btn">Join Us</button>
                </div>
            </div>
        </div>
        <div class="container expand-form">
            <div class="row form-row2">
                <form autocomplete="off" id="contact-form2" method="POST" action="{% url 'sendPage' %}">
                    <div id="contact-bdy2">
                        <div class="loader" id="loading2">
                            <div class="justify-content-center jimu-primary-loading"></div>
                        </div>
                        <div class="loader" id="done2" style="display: none">
                            <div class="container">
                                <svg id="checkmark2" class="checkmark justify-content-center" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                                    <path class="checkmark__check" fill="none" d="M14.1 29.5l7.1 7.2L37.9 17.4"/>
                                </svg>
                                <svg id="crossmark2" class="crossmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                                    <circle class="crossmark_circle" cx="26" cy="26" r="25" fill="none"/>
                                    <path class="crossmark_check" fill="none" d="M14.1 14.1l23.8 23.8 m0,-23.8 l-23.8,23.8"/>
                                </svg>
                                <div class="mail-sent2" style="display: none">Mail Sent</div>
                            </div>
                        </div>
                        <h1 id="contact-title2">Join Us</h1>
                        <div style="width: auto">
                            <div class="alert alert-success" role="alert" id="success_msg2">
                                Mail Sent Successfully, Please Check your Inbox
                            </div>
                        </div>
                        <div id="form_content2">
                            <div class="info">
                                <label class="nameLable2">Name</label>
                                <input class="name2" type="text" name="name" autocomplete="nothing">
                                <div class="error-message name-error2"></div> <!-- Add error message element -->

                                <label class="emailLable2">Email</label>
                                <input class="email2" type="email" name="email" autocomplete="nothing">
                                <div class="error-message email-error2"></div> <!-- Add error message element -->

                                <label class="phoneLable2">Phone Number</label>
                                <input class="phone2" type="text" name="phone" autocomplete="nothing">
                                <div class="error-message phone-error2"></div> <!-- Add error message element -->
                            </div>

                            <label class="descLable2">Outline Description (max 200 Words)</label>
                            <div>
                                <textarea class="desc2" rows="4" name="outline_desc" autocomplete="nothing"></textarea>
                                <div class="error-message desc-error2"></div> <!-- Add error message element -->
                            </div>
                        </div>
                        <div class="d-flex justify-content-center joinus-btn-div2" style="margin-top: 10px;margin-bottom: 10px">
                            <button type="button" class="joinus-btn" id="joinBTN3">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock content %}
<!-- Footer -->

{% block additional %}
<script>
    $(document).ready(function () {
        let counter = 0;
        const onScrollArray = ["#projects-title", "#join-section", "#footer-sec", ".expand-form"], arr = [];
        {% for i in items %}
            {% if i.isHome %}
            {% for j in i.images.all %}
                {% if j.thumbnail %}
                    arr.push("{{ j.url }}");
                {% endif %}
            {% endfor %}
                if (counter%2 !== 0){
                    $("#p{{ i.project_id }}-img").addClass('order-md-6');
                    $("#p{{ i.project_id }}-txt").addClass('order-md-1');
                }
                if (counter === 0){
                    $("#p{{ i.project_id }}-img").css('order', '1');
                    $("#p{{ i.project_id }}-txt").css('order', '2');
                }
                $("#p{{ i.project_id }}-img").css({
                    'opacity': '0',
                    'flex-basis': '100%',
                    'transform': 'translateY(20px)',
                    'transition': 'opacity 0.5s, transform 0.5s',
                });
                $("#p{{ i.project_id }}-txt").css({
                    'opacity': '0',
                    'flex-basis': '100%',
                    'transform': 'translateY(20px)',
                    'transition': 'opacity 0.5s, transform 0.5s',
                });
                $("#p{{ item.project_id }}").css({
                    'display': 'flex',
                    'flex-wrap': 'wrap',
                });
                onScrollArray.push("#p{{ i.project_id }}-img", "#p{{ i.project_id }}-txt");
                counter++;
            {% endif %}
        {% endfor %}

        // Function to handle animations on scroll
        function animateDivs() {
            const windowHeight = $(window).height();
            const scrollPosition = $(window).scrollTop();

            // Calculate the position at which the animation should start (85% from the top of the window)
            var animateStart = windowHeight * 0.3;

            var animationOnScroll = "";

            for(let j=0;j<onScrollArray.length;j++){
                if (j !== onScrollArray.length-1){
                    animationOnScroll += onScrollArray[j] + ', ';
                }else{
                    animationOnScroll += onScrollArray[j];
                }
            }

            // Check each element to see if it should be animated
            $(animationOnScroll).each(function () {
                const elementOffset = $(this).offset().top;
                if ($(this).attr('class') === "container expand-form"){
                    animateStart = windowHeight * 0.1;
                    if (elementOffset < scrollPosition + windowHeight - animateStart) {
                        $(this).addClass("animated");
                    }else {
                        if ($("#joinBTN2").text() === "Cancel"){
                            $("#joinBTN2").trigger('click');
                        }
                        $(this).removeClass("animated");
                    }
                }else{
                    if (elementOffset < scrollPosition + windowHeight - animateStart) {
                        $(this).addClass("animated");
                    }else {
                        if ($(this).attr('class') === "container expand-form" && $("#joinBTN2").text() === "Cancel"){
                            $("#joinBTN2").trigger('click');
                        }
                        $(this).removeClass("animated");
                    }
                }
            });
        }

        // Call the animateDivs function on initial page load
        animateDivs();
        // Call the animateDivs function on scroll
        $(window).on("scroll", function () {
            animateDivs();
        });
    $("#prev").hide();
    $("#next").hide();
    for(let i=0;i<arr.length;i++){
        if(i === 0){
            $("#slider-pics").append(
                "<div class=\"item active\" style=\"background: linear-gradient(rgba(0, 0, 0, 0.45),rgba(0, 0, 0, 0.45), " +
                "rgba(0, 0, 0, 0.45)), url(" + arr[i] + ") fixed no-repeat; background-size: cover\">" +
                "<div class=\"carousel-caption\"></div></div>"
            );
            $("#nav-slider").append(
                "<li id=\"nav-slider" + (i+1) + "\" data-target=\"#carousel-example-generic\" data-slide-to=\"" + i + "\" class=\"active\"></li>"
            );
        }else{
            $("#slider-pics").append(
                "<div class=\"item\" style=\"background: linear-gradient(rgba(0, 0, 0, 0.45),rgba(0, 0, 0, 0.45), " +
                "rgba(0, 0, 0, 0.45)), url(" + arr[i] + ") fixed no-repeat; background-size: cover\">" +
                "<div class=\"carousel-caption\"></div></div>"
            );
            $("#nav-slider").append(
                "<li id=\"nav-slider" + (i+1) + "\" data-target=\"#carousel-example-generic\" data-slide-to=\"" + i + "\"></li>"
            );
        }
    }
    let slideInterval;
    let click_count = 2;
        function changeSlide() {
            $("#nav-slider" + click_count).click();
            if (click_count < arr.length){
                click_count++;
            }else{
                click_count = 1;
            }
        }
        // Set the initial slide interval
        slideInterval = setInterval(changeSlide, 8000);

        // Add event listener for visibility change
        document.addEventListener("visibilitychange", function () {
            if (document.visibilityState === "hidden") {
                clearInterval(slideInterval);
            } else {
                slideInterval = setInterval(changeSlide, 8000);
            }
        });
    });
    $("#joinBTN2").on('click', function () {
        if ($(".expand-form").css('height') === "0px"){
            $(".expand-form").animate({
                height: "615.91px"
            }, 400, function () {
                $(".expand-form").css('height', 'auto')
            })
        }else{
            resetErrorMsgs();
            $(".expand-form").animate({
                height: "0"
            }, 400)
        }
        if (!$(this).hasClass('joinus-btn-cancel')){
            $(this).text("Cancel");
        }else{
            $(this).text("Join Us");
        }
        $(this).toggleClass('joinus-btn-cancel');
    });
    {##### 2nd Join Us Form #####}

        $(".phone2, .phoneLable2").on('click', function (){
            $(".phoneLable2").css({
                'top': '-4px',
                'color': 'white'
            });
            $(".phone2").css('height', '46px');
            $(document).on('mousedown', function (ev){
                if (!$(ev.target).closest('.phone2, .phoneLable2').length && $(".phone2").val() === "") {
                    $(".phoneLable2").css({
                        'top': '29.56px',
                        'color': 'black'
                    });
                    $(".phone2").css('height', '38px');
                }
            })
        });

        $(".phoneLable2, .nameLable2, .emailLable2, .descLable2").each(function (){
            $(this).on('click', function (){
                var selectedInput = "." + $(this).attr('class').replace("Lable","");
                $(selectedInput).focus();
            })
        });

        $(".name2, .nameLable2").on('click', function (){
            $(".nameLable2").css({
                'top': '-4px',
                'color': 'white'
            });
            $(".name2").css('height', '46px');
            $(document).on('mousedown', function (ev){
                if (!$(ev.target).closest('.name2, .nameLable2').length && $(".name2").val() === "") {
                    $(".nameLable2").css({
                        'top': '29.5px',
                        'color': 'black'
                    });
                    $(".name2").css('height', '38px');
                }
            })
        });

        $(".email2, .emailLable2").on('click', function (){
            $(".emailLable2").css({
                'top': '-4px',
                'color': 'white'
            });
            $(".email2").css('height', '46px');
            $(document).on('mousedown', function (ev){
                if (!$(ev.target).closest('.email2, .emailLable2').length && $(".email2").val() === "") {
                    $(".emailLable2").css({
                        'top': '29.5px',
                        'color': 'black'
                    });
                    $(".email2").css('height', '38px');
                }
            })
        });

        $(".name2, .email2, .phone2, .desc2").on("mousedown", function (){
            $(this).each(function (){
                $("." + $(this).attr('class').replace("2", "") + "Lable2").trigger('click');
            })
        })

        $(".desc2, .descLable2").on('click', function (){
            $(".descLable2").css({
                'top': '-4px',
                'color': 'white'
            });
            $(".desc2").css('height', '150px');
            $(document).on('mousedown', function (ev){
                if (!$(ev.target).closest('.desc2, .descLable2').length && $(".desc2").val() === "") {
                    $(".descLable2").css({
                        'top': '29.5px',
                        'color': 'black'
                    });
                    $(".desc2").css('height', '38px');
                }
            })
        });

        function resetErrorMsgs() {
            $(".name-error2, .phone-error2, .email-error2, .desc-error2").css('margin-bottom', '0').hide();
            $(".name2, .phone2, .email2, .desc2").css({
                'height': '38px',
                'margin-bottom': '15px'
            }).val("");
            $(".nameLable2, .phoneLable2, .emailLable2, .descLable2").css({
                'top': '29.5px',
                'color': 'black'
            });
        }

        function validateName2() {
            const nameInput = $(".name2");
            const name = nameInput.val();
            const nameError = $(".name-error2");

            if (name.trim() === "") {
                nameError.text("").hide();
                nameError.css('margin-bottom', '0');
                return true;
            }

            if (/\d/.test(name)){
                nameError.text("Name must not contains numbers").show();
                nameError.css('margin-bottom', '10px');
                return false;
            }

            nameError.css('margin-bottom', '0');
            nameError.hide();
            return true;
        }

        // Validation function for the email input
        function validateEmail2() {
            const emailInput = $(".email2");
            const email = emailInput.val();
            const emailError = $(".email-error2");
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;

            if (email.trim() === "") {
                emailError.text("").hide();
                emailError.css('margin-bottom', '0');
                return true;
            }

            if (!emailPattern.test(email)) {
                emailError.text("Please enter a valid email address").show();
                emailError.css('margin-bottom', '10px');
                return false;
            }
            emailError.css('margin-bottom', '0');
            emailError.hide();
            return true;
        }

        // Validation function for the phone input
        function validatePhone2() {
            const phoneInput = $(".phone2");
            const phone = phoneInput.val();
            const phoneError = $(".phone-error2");
            const phonePattern = /^\d{11}$/; // Allow up to 15 digits

            if (phone.trim() === "") {
                phoneError.text("").hide();
                phoneError.css('margin-bottom', '0');
                return true;
            }

            if (isNaN(phone)){
                phoneError.text("Phone number must be numeric only").show();
                phoneError.css('margin-bottom', '10px');
                return false;
            }

            if (!phonePattern.test(phone)) {
                phoneError.text("Please enter a valid phone number with 11 digits").show();
                phoneError.css('margin-bottom', '10px');
                return false;
            }

            phoneError.css('margin-bottom', '0');
            phoneError.hide();
            return true;
        }

        // Validation function for the description textarea
        function validateDescription2() {
            const descTextarea = $(".desc2");
            const desc = descTextarea.val();
            const descError = $(".desc-error2");

            if (desc.length > 200) {
                descError.text("Please don't exceed 200 characters").show();
                descError.css('margin-bottom', '10px');
                return false;
            }
            descError.css('margin-bottom', '0');
            descError.hide();
            return true;
        }

        $(".name2, .email2, .phone2, .desc2").on("input", function (){
            $(this).each(function (){
                if ($(this).attr('class') === "name2"){
                    if(!validateName2()){
                        $(this).css({
                            'border-color': 'red',
                            'margin-bottom': '0',
                        });
                    }else{
                        $(this).css({
                            'border-color': '',
                            'margin-bottom': '15px',
                        });
                    }
                }else if ($(this).attr('class') === "email2"){
                    if(!validateEmail2()){
                        $(this).css({
                            'border-color': 'red',
                            'margin-bottom': '0',
                        });
                    }else{
                        $(this).css({
                            'border-color': '',
                            'margin-bottom': '15px',
                        });
                    }
                }else if ($(this).attr('class') === "phone2"){
                    if(!validatePhone2()){
                        $(this).css({
                            'border-color': 'red',
                            'margin-bottom': '0',
                        });
                    }else{
                        $(this).css({
                            'border-color': '',
                            'margin-bottom': '15px',
                        });
                    }
                }else{
                    if(!validateDescription2()){
                        $(this).css({
                            'border-color': 'red',
                            'margin-bottom': '0',
                        });
                    }else{
                        $(this).css({
                            'border-color': '',
                            'margin-bottom': '15px',
                        });
                    }
                }
            })
        })

        // Validate if Any Field is Left Blank
        function isBlank2(){
            var nameBlank = false,
                emailBlank = false,
                phoneBlank = false,
                descBlank = false;
            $(".name2, .email2, .phone2, .desc2").each(function (){
                if ($(this).val() === ""){
                    $("." + $(this).attr('class').replace("2", "") + "-error2").text("This field is required").show();
                    $("." + $(this).attr('class').replace("2", "") + "-error2").css('margin-bottom', '10px');
                    $(this).css('margin-bottom', '0');
                    if ($(this).attr('class') === 'name2'){
                        nameBlank = true;
                    }else if ($(this).attr('class') === 'email2'){
                        emailBlank = true;
                    }else if ($(this).attr('class') === 'phone2'){
                        phoneBlank = true;
                    }else{
                        descBlank = true;
                    }
                }else{
                    $("." + $(this).attr('class').replace("2", "") + "-error2").text("").hide();
                    $("." + $(this).attr('class').replace("2", "") + "-error2").css('margin-bottom', '0');
                    $(this).css('margin-bottom', '15px');
                    if ($(this).attr('class') === 'name2'){
                        nameBlank = false;
                    }else if ($(this).attr('class') === 'email2'){
                        emailBlank = false;
                    }else if ($(this).attr('class') === 'phone2'){
                        phoneBlank = false;
                    }else{
                        descBlank = false;
                    }
                }
            })
            return nameBlank || emailBlank || phoneBlank || descBlank;
        }

        var mailSentTime = 5000;

        $("#joinBTN3").click(function () {
            const isNameValid = validateName2();
            const isEmailValid = validateEmail2();
            const isPhoneValid = validatePhone2();
            const isDescValid = validateDescription2();
            const isBlankValidation = isBlank2();
            if (isNameValid && isEmailValid && isPhoneValid && isDescValid && !isBlankValidation) {
                $("#form_content2").css({
                    'opacity': '0',
                    'position': 'relative',
                    'z-index': '-1',
                });
                if ($("#success_msg2").css('opacity') === "1") {
                    $("#success_msg2").css({
                        'opacity': '0',
                    });
                    $("#form_content2").animate({
                        marginTop: '-52px'
                    }, 200)
                }
                $(".joinus-btn-div2").css('opacity', '0');
                $("#joinBTN3, input, textarea").attr('disabled', 'true');
                $("#loading2").css('opacity', '1');
                var failed = false;
                const form = document.getElementById('contact-form2');
                const formData = new FormData(form);
                formData.append('name', $(".name2").val());
                formData.append('email', $(".email2").val());
                formData.append('phone', $(".phone2").val());
                formData.append('outline_desc', $(".desc2").val());
                formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                var duplicated = false;
                fetch('/fetchCustomer?name=' + $(".name2").val() + '&email=' + $(".email2").val()
                    + '&phone=' + $(".phone2").val() + '&desc=' + $(".desc2").val())
                    .then(response => response.json())
                    .then(data => {
                        // Process the JSON data here
                        const customers = data.customers;
                        for (const customer of customers) {
                            duplicated = customer.duplicated;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                fetch('/send/', {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => {
                        if (response.status === 200 && !duplicated) {
                            $(".mail-sent2").text("Mail Sent");
                            $("#success_msg2").text("Mail Sent Successfully, Please Check your Inbox");
                            $("#crossmark2").css('display', 'none');
                            $("#checkmark2").css('display', 'block');
                        } else if (duplicated) {
                            failed = true;
                            $(".mail-sent2").text("Mail Failed To Be Sent");
                            $("#success_msg2").text("Mail Failed To Be Sent, Your Email Has Already Been Registered");
                            $("#checkmark2").css('display', 'none');
                            $("#crossmark2").css('display', 'block');
                        } else {
                            $(".mail-sent2").text("Mail Failed To Be Sent");
                            $("#success_msg2").text("Mail Failed To Be Sent, Please Validate Your Email!");
                            $("#checkmark2").css('display', 'none');
                            $("#crossmark2").css('display', 'block');
                        }
                    })
                setTimeout(function () {
                    $("#loading2").css('opacity', '0');
                    $("#done2").css({
                        'opacity': '1',
                        'display': '',
                    });
                    $(".mail-sent2").css({
                        'display': '',
                    });
                }, mailSentTime / 2)
                $(".name2, .email2, .phone2, .desc2").each(function (){
                    $(this).val("");
                    $("#contact-form2").trigger('mousedown');
                })
                setTimeout(function () {
                    $("#form_content2").css({
                        'opacity': '1',
                        'position': '',
                        'z-index': '',
                    });
                    $("#form_content2").animate({
                        marginTop: '10px'
                    }, 200)
                    $(".joinus-btn-div2").css('opacity', '1');
                    $("#joinBTN3, input, textarea").removeAttr('disabled');
                    $("#loading2").css('opacity', '0');
                    $("#done2").css({
                        'opacity': '0',
                        'display': 'none',
                    });
                    $(".mail-sent2").css({
                        'display': 'none',
                    });
                    if (!duplicated) {
                        $("#success_msg2").attr('class', 'alert alert-success');
                    } else {
                        $("#success_msg2").attr('class', 'alert alert-danger');
                    }
                    $("#success_msg2").css({
                        'opacity': '1',
                    });
                    setTimeout(function () {
                        $("#success_msg2").css({
                            'opacity': '0',
                        });
                        $("#form_content2").animate({
                            marginTop: '-52px'
                        }, 200)
                    }, 5000);
                }, mailSentTime)
            }
        })
    {############################}
</script>
{% endblock additional %}
